# 描述
这里是故事脚本的编译模块，
故事脚本就是控制游戏流程的文件，建议先看“/doc/概述”
因为故事脚本功能稳定，所以单独成了模块

编译脚本文件,包括全部的编译过程
# 接口
见index.d.ts
# 语法
经过几代改版，现在是比较合适的语法

**普通剧情文本**

不需要任何标志，一行代表一个对话框文本

```
这是一个夏天。
```

如果需要带上人物名称，语法为中括号加上名称加上对话

```
[行人]你没长眼睛啊！
```

**剧情加载**

```
#load "name"
#load "fil e" "name"
```

**选项**

```
#choice '选项1' '文字' '文字'
```

字符串内仍然需要转义

```
#ch1 {
}
#ch2 {
}
```

为了更加好看和易于管理，可以这么写,在选项内部跳转，避免嵌套层数太多

````
#choice '选项1' '文字' '文字'
#ch1 {
#load "file" "dis1"
}
#ch2 {
#load "file" "dis2"
}
````

**分支条件**

```
#if 'a+b+1=c' {

}#elseif 'c>=0'{

}#else{

}
```

变量名命名，

+ 不以数字开头
+ 不含有符号（_除外）

运算和比较：

+ 只能够+-，比较有>,<,>=,<=

这样做的原因是，防止数值被滥用，由于不是专业程序员，所以不建议在里面写过于复杂的逻辑

**数值操作**

```
#set 'name' 'a+b+c'
#record 'name' 'a+b+c'
```

set的含义是对于周目内使用的数值，每个周目是不保存的

record是始终有效，跨周目

**定义剧情块**

剧情块就相当于函数，可以从其他地方执行这个剧情

```
#block 'name'{
}
```

**声音请求**
```
#voice {
  //any code here
}
或者单条简写
#voice     ;
```
**画面请求**
```
#render{

}
或者单条简写
#render     ;
```
**通用中断请求**
````
//只有单行
#break name xxx xxx xxx xxx
#break 1 '1 1' "1 1" ds
````
**强制等待**
```
//打断核心的执行流程多少时间
#wait time=1000
```
**转义符**

语法中使用到的符号都需要转义

我觉得，现在的语法还是过于复杂，

其实我还考虑过一些特性，

+ 中文关键字
+ 全角符和半角符通用
+ 省略语法

# 指令集
```
{type:101,data:{name,text}}
普通对话

{type:102,data:{choice:[{name,offset},{name}]}}
选项

{type:201,data:{name,value}}
设定普通周目内数值

{type:202,data:{name,value}}
设定周目数值

{type:203,data:{tag:{left:[],sign,right:[]},offset}}
不符合条件跳转

{type:204,data:{file,name}}
载入剧情块

{type:301,data:{para?:[],code}}
声音请求

{type:302,data:{para?:[],code}}
渲染请求

{type:401,data:{}}
通用中断请求

{type:501,data:{time}}
强制阻塞
```